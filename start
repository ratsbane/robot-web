#!/bin/bash

# Set -e: Exit immediately if a command exits with a non-zero status.
set -e

# Project directory
PROJECT_DIR="/var/www/robot"

# Activate the virtual environment
echo "Activating virtual environment..."
source "$PROJECT_DIR/venv/bin/activate"

# Check if the virtual environment is activated
if [ -z "$VIRTUAL_ENV" ]; then
    echo "Error: Virtual environment not activated."
    exit 1
fi

# Start robot_control_service.py in the background
echo "Starting robot_control_service.py..."
nohup python3 "$PROJECT_DIR/robot_control_service.py" > "$PROJECT_DIR/robot_control_service.log" 2>&1 &
echo "robot_control_service.py started with PID: $!"

# Start websocket_server.py with Uvicorn in the background
echo "Starting websocket_server.py with Uvicorn..."
nohup uvicorn websocket_server:app --host 0.0.0.0 --port 8000 > "$PROJECT_DIR/websocket_server.log" 2>&1 &
echo "websocket_server.py started with PID: $!"

# Start web_server.py with Uvicorn
#echo "Starting web_server.py with Uvicorn..."
#nohup uvicorn web_server:app --host 0.0.0.0 --port 5000 > "$PROJECT_DIR/web_server.log" 2>&1 &
#echo "web_server.py started with PID: $!"

echo "All services started and detached from terminal."

